---
title: "The Secret of Happiness"
author: "Qi Yuchen (yq2279)"
date: "2019/12/4"
output: html_document
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(viridis)
library(plotly)
library(readxl)
library(countrycode)
library(flexdashboard)
library(ggmap)


knitr::opts_chunk$set(
  fig.width = 6,
  out.width = "90%",
 fig.align = "center"
)

theme_set(theme_bw() + theme(plot.title = element_text(hjust = 0.5)))
```

## Introduction

In living memory, people paid a lot of attention to their health, especially their physical health. Yet with the development of modern technology in medicine and a more comprehensive medical care system, the general physical health of the majority seems to be in good care. With the guarantee of their basic physical health, people tend to pay more attention to their mental health. This tendency drives the more frequent appearance of depressing topics such as “Depression” and “Suicide”. Yet, in order to make progress and actually change the depressing situation, people should not only focus on these issues, but also concentrate on happier thoughts. Hence, in this research, we focus on happiness, how people feel about their well-being and happiness across countries, and focus on how the feeling of happy changes over years and the association or even casual effects between several variables.  

The debate of whether higher gdp can increase hapiness is never endless. Some say it does, thus we should work hardly on raising gdp. Some say it actually has a quite opposite influence on our hapiness. Which opinion is true according to our data? We choose gdp as one of the potential key variables to find the association. 

Also, humans are an extremely prosocial species. Compared to most primates, humans provide more assistance to family, friends, and strangers, even when costly. Some evidence indicate that there is well-being benefits from donating money.

Moreover, according to our previous exploration, we can tell that there is an obvious association between age and happiness. 

Both related to money, what's the association between these two variable and happiness? To answer this question, we use the following three variables to find the best linear model that describes the association. 


## Research questions

Our research questions are the following:

- How people's feeling of happiness differ by where they live?
- 
- 
- 



## Data

### Data sources

Our data was downloaded as a .csv file from [World Poll](https://analyticscampus.gallup.com/?ref=Auth).  

### Data cleaning

To analyze our data by continent, we need to add the continent variable.

```{r}
## add continents
df = read_xls("data/Chapter2OnlineData.xls") %>% 
  janitor::clean_names()
df = df %>% 
  mutate(continent = countrycode(sourcevar = country_name,
                                 origin = "country.name",
                                 destination = "continent")) %>% 
  select(continent, country_name, everything())
```

### Data description

`life_ladder` represent the happiness score or subjective well-being which was measured by the Gallup World Poll(GWP) covering years from 2005 to 2018,

`gdp` represent the log transformation of statistics of GDP per capita in purchasing power parity(PPP) at constant 2011 international dollar prices are from the November 14,2018 update of the World Development Indicators (WDI).

`generosity` is the residual of regressing national average of response to the GWPquestion “Have you donated money to a charity in the past month?” on GDP per capita.

`age` is devided into 3 age groups: 15-30, 30-49, 50+.


## Exploratory analysis

### Geographica

The geographical distribution of happiness across 165 countries were visualized. We get the GENC 3-letter codes for countries applying the countrycode function, and produced interactive plots. Screenshots of these maps are shown below. To see the fully rendered versions, visit our [website](https://qi-yuchen.github.io/P8105_final_project/Geographica.html). This exploration did not intend to find any associations, at least not in  a rigorous way, but to provide us and our readers a tool to interact with our data and get an direct understanding of the current situation of people's feeling of happiness worldwide. From the distribution [map](https://qi-yuchen.github.io/P8105_final_project/Geo_world.html), we can see mean life ladder over years in Europe and Americas is significantly higher than that in Asia and Africa. 

The code for rending these plots are the following:

For this part, the mean life ladder and the country code for each country are needed to produce the global map. 

```{r, eval=FALSE}
## add the mean happiness
df_geo = df %>% 
  select(continent, country = country_name, year, life_ladder) %>% 
  group_by(continent, country) %>% 
  summarise(mean_life_ladder = mean(life_ladder)) %>% 
  ungroup()
df_geo$continent[165] = "Europe"

## add the country code
df_geo = df_geo %>% 
  mutate(code = countrycode(sourcevar = country,
                                 origin = "country.name",
                                 destination = "genc3c"))
```

Global view

```{r, eval=FALSE}
# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

# specify map projection/options
g <- list(
  showframe = FALSE,
  showcoastlines = FALSE,
  projection = list(type = 'Mercator')
)

# here is the map
plot_geo(df_geo) %>%
  add_trace(
    z = ~mean_life_ladder, color = ~mean_life_ladder, colors = 'Blues',
    text = ~country, locations = ~code, marker = list(line = l)
  ) %>%
  colorbar(title = 'Expectation of life ladder') %>%
  layout(
    title = 'Global Distribution of Happiness',
    geo = g
  )
```

Continent view

```{r, eval=FALSE}
# Africa
df_geo %>% 
  filter(continent == "Africa") %>% 
  mutate(country = reorder(country, mean_life_ladder)) %>% 
  plot_ly(x = ~country, y = ~mean_life_ladder, color = ~country, type = "bar") %>% 
  layout(
    xaxis = list(title = "country name", tickangle = -45),
    yaxis = list(title = "expectation of life ladder", range = c(0,8))
    )

# Americas
df_geo %>% 
  filter(continent == "Americas") %>% 
  mutate(country = reorder(country, mean_life_ladder)) %>% 
  plot_ly(x = ~country, y = ~mean_life_ladder, color = ~country, type = "bar") %>% 
  layout(
    xaxis = list(title = "country name", tickangle = -45),
    yaxis = list(title = "expectation of life ladder", range = c(0,8))
    )

# Asia and Oceania
df_geo %>% 
  filter(continent == "Asia" | continent == "Oceania") %>% 
  mutate(country = reorder(country, mean_life_ladder)) %>% 
  plot_ly(x = ~country, y = ~mean_life_ladder, color = ~country, type = "bar") %>% 
  layout(
    xaxis = list(title = "country name", tickangle = -45),
    yaxis = list(title = "expectation of life ladder", range = c(0,8))
    )

# Europe
df_geo %>% 
  filter(continent == "Europe") %>% 
  mutate(country = reorder(country, mean_life_ladder)) %>% 
  plot_ly(x = ~country, y = ~mean_life_ladder, color = ~country, type = "bar") %>% 
  layout(
    xaxis = list(title = "country name", tickangle = -45),
    yaxis = list(title = "expectation of life ladder", range = c(0,8))
    )
```


### Age


### Time


## Additional analysis


## Discussion

